generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id        BigInt   @id @default(autoincrement()) @map("id")
  name      String   @map("name")
  email     String   @unique @map("email")
  username  String   @unique @map("username")
  password  String   @map("password")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  roles          UserHasRole[]

  @@map("user")
}

model Role {
  id   BigInt @id @default(autoincrement()) @map("id")
  name String @unique @map("name")

  permissions RoleHasPermission[]
  users       UserHasRole[]

  @@map("role")
}

model Permission {
  id   BigInt @id @default(autoincrement()) @map("id")
  name String @unique @map("name")

  roles RoleHasPermission[]

  @@map("permission")
}

model UserHasRole {
  userId BigInt @map("user_id")
  roleId BigInt @map("role_id")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@id([userId, roleId])
  @@map("user_has_role")
}

model RoleHasPermission {
  roleId       BigInt @map("role_id")
  permissionId BigInt @map("permission_id")

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@id([roleId, permissionId])
  @@map("role_has_permission")
}

model Cctv {
  id        BigInt   @id @default(autoincrement())
  name      String?
  latitude  Float?
  longitude Float?
  ip        String?
  status    String?
  username  String?
  password  String?
  createdAt DateTime @default(now()) @map("created_at")

  @@map("cctv")
}

model Province {
  id     BigInt  @id
  name   String?
  cities City[]

  @@map("province")
}

model City {
  id           BigInt        @id
  name         String?
  provinceId   BigInt
  province     Province      @relation(fields: [provinceId], references: [id], onDelete: Cascade)
  subDistricts SubDistrict[]

  @@map("city")
}

model SubDistrict {
  id       BigInt    @id
  name     String?
  cityId   BigInt
  city     City      @relation(fields: [cityId], references: [id], onDelete: Cascade)
  villages Village[]

  @@map("sub_district")
}

model Village {
  id               BigInt                  @id
  name             String?
  subDistrictId    BigInt
  hydraulicOutputs HydraulicOutputHecras[]
  subDistrict      SubDistrict             @relation(fields: [subDistrictId], references: [id], onDelete: Cascade)

  @@map("village")
}

model Das {
  id                BigInt                   @id @default(autoincrement())
  name              String?
  arrStations       ArrStation[]
  awlrStations      AwlrStation[]
  awsStations       AwsStation[]
  hydrologicOutputs HydrologicOutputHechms[]

  @@map("das")
}

model AwsStation {
  id                  BigInt                   @id @default(autoincrement())
  device_id           String?                  @unique
  managed_by          String?
  post_name           String?
  dasId               BigInt?
  time                DateTime?
  rainfall            Float?
  air_temperature_avg Float?
  relative_humidity   Float?
  wind_speed          Float?
  wind_direction      Float?
  solar_radiation_avg Float?
  battery             Float?
  panel_temperature   Float?
  image               String?
  villageId           BigInt?
  latitude            Float?
  longitude           Float?
  built_by            String?
  built_year          String?
  renovated_by        String?
  renovated_year      String?
  alert_level_1       Float?
  alert_level_2       Float?
  alert_level_3       Float?
  alert_level_4       Float?
  status              String?
  is_active           Boolean?                 @default(true)
  logs                AwsLog[]
  das                 Das?                     @relation(fields: [dasId], references: [id])
  hydrologicOutputs   HydrologicOutputHechms[]

  @@map("aws_stations")
}

model AwsLog {
  id                  BigInt      @id @default(autoincrement())
  aws_station_id      BigInt?
  time                DateTime?
  rainfall            Float?
  air_temperature_avg Float?
  relative_humidity   Float?
  wind_speed          Float?
  wind_direction      Float?
  solar_radiation_avg Float?
  battery             Float?
  status              String?
  post_name           String?
  station             AwsStation? @relation(fields: [aws_station_id], references: [id], onDelete: Cascade)

  @@map("aws_logs")
}

model AwlrStation {
  id                BigInt                   @id @default(autoincrement())
  device_id         String?                  @unique
  managed_by        String?
  post_name         String?
  dasId             BigInt?
  river_name        String?
  time              DateTime?
  water_level       Float?
  battery           Float?
  panel_temperature Float?
  image             String?
  flow_ho           Float?
  flow_a            Float?
  flow_b            Float?
  debit             Float?
  villageId         BigInt?
  latitude          Float?
  longitude         Float?
  built_by          String?
  built_year        String?
  renovated_by      String?
  renovated_year    String?
  alert_level_1     Float?
  alert_level_2     Float?
  alert_level_3     Float?
  status            String?
  is_active         Boolean?                 @default(true)
  logs              AwlrLog[]
  das               Das?                     @relation(fields: [dasId], references: [id])
  hydrologicOutputs HydrologicOutputHechms[]
  riverSections     RiverSectionPoint[]

  @@map("awlr_stations")
}

model AwlrLog {
  id                BigInt       @id @default(autoincrement())
  awlr_station_id   BigInt?
  time              DateTime?
  water_level       Float?
  battery           Float?
  panel_temperature Float?
  status            String?
  post_name         String?
  debit             Float?
  station           AwlrStation? @relation(fields: [awlr_station_id], references: [id], onDelete: Cascade)

  @@map("awlr_logs")
}

model ArrStation {
  id                BigInt                   @id @default(autoincrement())
  device_id         String?                  @unique
  managed_by        String?
  post_name         String?
  dasId             BigInt?
  time              DateTime?
  rainfall          Float?
  battery           Float?
  panel_temperature Float?
  image             String?
  villageId         BigInt?
  latitude          Float?
  longitude         Float?
  built_by          String?
  built_year        String?
  renovated_by      String?
  renovated_year    String?
  alert_level_1     Float?
  alert_level_2     Float?
  alert_level_3     Float?
  alert_level_4     Float?
  status            String?
  is_active         Boolean?                 @default(true)
  logs              ArrLog[]
  das               Das?                     @relation(fields: [dasId], references: [id])
  hydrologicOutputs HydrologicOutputHechms[]

  @@map("arr_stations")
}

model ArrLog {
  id                BigInt      @id @default(autoincrement())
  arr_station_id    BigInt?
  time              DateTime?
  rainfall          Float?
  battery           Float?
  panel_temperature Float?
  status            String?
  post_name         String?
  station           ArrStation? @relation(fields: [arr_station_id], references: [id], onDelete: Cascade)

  @@map("arr_logs")
}

model ContactWa {
  id          BigInt      @id @default(autoincrement())
  name        String?
  phoneNumber String?     @map("phone_number")
  description String?
  status      String?
  type        String?
  messages    MessageWa[]

  @@map("contact_wa")
}

model MessageWa {
  id          BigInt     @id @default(autoincrement())
  contact_id  BigInt?
  messageText String?    @db.Text
  created_at  DateTime?
  contact     ContactWa? @relation(fields: [contact_id], references: [id], onDelete: Cascade)

  @@map("message_wa")
}

model Report {
  id       BigInt         @id @default(autoincrement())
  category String?
  details  ReportDetail[]

  @@map("report")
}

model ReportDetail {
  id             BigInt    @id @default(autoincrement())
  category_id    BigInt?
  title          String?
  news           String?
  date           DateTime?
  status         String?
  image          String?
  reportCategory Report?   @relation(fields: [category_id], references: [id])

  @@map("report_details")
}

model HydrologyRequest {
  id              BigInt  @id @default(autoincrement())
  name            String?
  email           String?
  phone           String?
  institution     String?
  uploaded_letter String?
  feedback        String?

  @@map("hydrology_requests")
}

model HydraulicOutputHecras {
  id                   BigInt                  @id @default(autoincrement())
  hydrologic_output_id BigInt?
  time                 DateTime?
  flood_depth          Float?
  flow_velocity        Float?
  inundation_area      Float?
  model_type           String?
  model_version        String?
  parameter_set        String?
  village_id           BigInt?
  hydrologic_output    HydrologicOutputHechms? @relation(fields: [hydrologic_output_id], references: [id])
  village              Village?                @relation(fields: [village_id], references: [id])

  @@map("hydraulic_output_hecras")
}

model HydrologicOutputHechms {
  id               BigInt                  @id @default(autoincrement())
  das_id           BigInt?
  time             DateTime?
  debit            Float?
  volume           Float?
  model_type       String?
  model_version    String?
  parameter_set    String?
  awlr_station_id  BigInt?
  aws_station_id   BigInt?
  arr_station_id   BigInt?
  hydraulicOutputs HydraulicOutputHecras[]
  arr_station      ArrStation?             @relation(fields: [arr_station_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  awlr_station     AwlrStation?            @relation(fields: [awlr_station_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  aws_station      AwsStation?             @relation(fields: [aws_station_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  das              Das?                    @relation(fields: [das_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("hydrologic_output_hechms")
}

model Vehicle {
  id                   BigInt    @id @default(autoincrement())
  name                 String?
  driver_name          String?
  driver_phone         String?
  registration         String?   @unique
  chassis_number       String?
  time                 DateTime?
  latitude             Float?
  longitude            Float?
  position_description String?
  speed                Float?
  bearing              Int?
  vehicle_status       Boolean?  @default(true)
  idling               Boolean?  @default(true)
  odometer             BigInt?
  altitude             Float?
  fuel_level           Float?
  fuel_percentage      Float?
  created_at           DateTime?

  @@map("vehicle")
}

model Sirine {
  id                    BigInt    @id @default(autoincrement())
  name                  String?
  address               String?
  latitude              Float?
  longitude             Float?
  device_name           String?
  firmware_version      String?
  status_logger         String?
  last_comm_success     DateTime?
  is_active             Boolean?
  outdated_alarm_status String?
  outdated_data_time    DateTime?
  battery_voltage       Float?
  battery_unit          String?
  battery_status_alarm  String?
  on_control_value      Int?
  on_control_state      String?
  off_control_value     Int?
  off_control_state     String?
  off_control_state_id  String?
  off_control_url       String?
  on_control_state_id   String?
  on_control_url        String?
  is_sirine_on          Boolean?  @default(false)
  updated_at            DateTime? @updatedAt

  @@map("sirine")
}

model RiverSectionPoint {
  id             BigInt      @id @default(autoincrement())
  x              Float
  y              Float
  elevation      Float
  distance       Float
  awlrStationId  BigInt?
  awlrStation    AwlrStation? @relation(fields: [awlrStationId], references: [id])

  @@map("river_section_points")
}

model AppSetting {
  id        BigInt   @id @default(autoincrement()) @map("id")
  key       String   @unique @map("key")
  type      String   @map("type")
  value     String?  @db.Text @map("value")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt     @map("updated_at")

  @@map("app_setting")
}
